<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Job Application Counter (v2)</title>
<!-- Favicon -->
<link rel="icon" type="image/png" href="favicon/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="favicon/favicon.svg" />
<link rel="shortcut icon" href="favicon/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png" />
<link rel="manifest" href="favicon/site.webmanifest" />

<style>
  :root{
    --bg:#0e0f13;
    --panel:#151823;
    --panel2:#111423;
    --text:#e6e8ee;
    --muted:#9aa0b3;
    --accent:#4f8cff;
    --danger:#ff5c5c;
    --border:#262a3b;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
  }

  *{ box-sizing:border-box; }
  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    background:var(--bg);
    color:var(--text);
  }
  .app{
    max-width:820px;
    margin:36px auto;
    padding:20px;
  }
  header{
    display:flex;
    align-items:flex-end;
    justify-content:space-between;
    gap:16px;
    margin-bottom:14px;
  }
  h1{
    margin:0;
    font-size:20px;
    letter-spacing:.4px;
  }
  .sub{
    margin-top:6px;
    color:var(--muted);
    font-size:13px;
  }

  .card{
    background:linear-gradient(180deg, var(--panel), var(--panel2));
    border:1px solid var(--border);
    border-radius:12px;
    box-shadow:var(--shadow);
    overflow:hidden;
  }

  .controls{
    display:flex;
    gap:10px;
    padding:14px;
    border-bottom:1px solid var(--border);
    flex-wrap:wrap;
  }

  input{
    flex:1 1 240px;
    min-width: 200px;
    padding:12px 12px;
    background:#0f1220;
    border:1px solid var(--border);
    color:var(--text);
    border-radius:10px;
    outline:none;
  }
  input::placeholder{ color:#6f778f; }

  button{
    padding:12px 12px;
    border-radius:10px;
    border:none;
    cursor:pointer;
    font-weight:700;
    letter-spacing:.2px;
    transition: transform .05s ease;
    white-space:nowrap;
  }
  button:active{ transform: translateY(1px); }

  .btn{
    background:var(--accent);
    color:#fff;
  }
  .btn.secondary{
    background:transparent;
    border:1px solid var(--border);
    color:var(--muted);
  }
  .btn.danger{
    background:var(--danger);
    color:#fff;
  }

  .toolbar{
    display:flex;
    gap:10px;
    padding:14px;
    border-bottom:1px solid var(--border);
    flex-wrap:wrap;
    align-items:center;
    justify-content:space-between;
  }
  .totals{
    display:flex;
    gap:12px;
    align-items:center;
    flex-wrap:wrap;
  }
  .pill{
    border:1px solid var(--border);
    background:#0f1220;
    padding:8px 10px;
    border-radius:999px;
    font-size:13px;
    color:var(--muted);
  }
  .pill b{ color:var(--text); font-weight:800; }

  .io{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
  }
  .file{
    display:none;
  }

  table{
    width:100%;
    border-collapse:collapse;
  }
  thead{ display:table-header-group; }
  th,td{
    padding:12px 14px;
    border-bottom:1px solid var(--border);
    text-align:left;
    vertical-align:middle;
  }
  th{
    color:var(--muted);
    font-size:12px;
    font-weight:800;
    text-transform:uppercase;
    letter-spacing:.8px;
  }
  .count{
    font-weight:900;
    font-size:16px;
  }
  .actions{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
  }
  .actionBtn{
    padding:8px 10px;
    border-radius:10px;
    font-weight:900;
    border:1px solid var(--border);
    background:#0f1220;
    color:var(--text);
    min-width:44px;
    text-align:center;
  }
  .actionBtn.plus{ border-color:rgba(79,140,255,.4); }
  .actionBtn.minus{ border-color:rgba(154,160,179,.35); }
  .actionBtn.del{
    border:none;
    background:rgba(255,92,92,.95);
    color:#fff;
  }

  .empty{
    text-align:center;
    color:var(--muted);
    padding:22px 12px;
  }

  /* Mobile: switch table to stacked cards */
  @media (max-width: 640px){
    .app{ margin:18px auto; padding:14px; }
    header{ align-items:flex-start; flex-direction:column; }
    .controls{ padding:12px; }
    input{ flex:1 1 100%; min-width:0; }
    button{ flex:1 1 auto; }
    .io button{ flex:1 1 auto; }

    table, thead, tbody, th, td, tr { display:block; }
    thead{ display:none; }
    tr{
      padding:12px;
      border-bottom:1px solid var(--border);
    }
    tr:last-child{ border-bottom:none; }
    td{
      border-bottom:none;
      padding:6px 0;
    }
    td:nth-child(1){
      font-weight:900;
      font-size:15px;
      padding-top:0;
    }
    td:nth-child(2){
      display:flex;
      gap:8px;
      align-items:center;
      color:var(--muted);
    }
    td:nth-child(2) .count{
      color:var(--text);
      font-size:18px;
    }
    td:nth-child(3){ padding-bottom:0; }
    .actions{
      width:100%;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
    }
    .actionBtn{ width:100%; min-width:0; padding:12px 10px; font-size:16px; }
  }
</style>
</head>

<body>
<div class="app">
  <header>
    <div>
      <h1>Job Application Counter</h1>
      <div class="sub">Manual date → one row per date → + / − → persistent memory</div>
    </div>
  </header>

  <div class="card">
    <div class="controls">
      <input id="dateInput" placeholder="Enter date (e.g. 2026-01-01 or Jan 1 2026)" />
      <button class="btn" id="addBtn" type="button">Add Date</button>
      <button class="btn danger" id="resetBtn" type="button">Reset All</button>
    </div>

    <div class="toolbar">
      <div class="totals">
        <div class="pill">Grand Total: <b id="grandTotal">0</b></div>
        <div class="pill">Dates Tracked: <b id="datesTracked">0</b></div>
      </div>

      <div class="io">
        <button class="btn secondary" id="exportBtn" type="button">Export Backup</button>
        <button class="btn secondary" id="importBtn" type="button">Import Backup</button>
        <input class="file" id="importFile" type="file" accept="application/json" />
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th style="width:55%;">Date</th>
          <th style="width:15%;">Count</th>
          <th style="width:30%;">Actions</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
</div>

<script>
/**
 * v2 Features:
 * - Responsive / mobile-optimized (table → stacked cards)
 * - Export/Import JSON backup
 * - LocalStorage persistence
 */

const STORAGE_KEY = "jobCounterData_v2";
let data = loadSafe();

function loadSafe() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    const parsed = raw ? JSON.parse(raw) : {};
    return (parsed && typeof parsed === "object" && !Array.isArray(parsed)) ? parsed : {};
  } catch {
    return {};
  }
}

function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function parseUserDate(input) {
  // Try native Date parsing
  const d = new Date(input);
  if (!isNaN(d)) return d;

  // Try common "YYYY-MM-DD" manually (more strict)
  const m = input.match(/^(\d{4})-(\d{2})-(\d{2})$/);
  if (m) {
    const year = Number(m[1]), month = Number(m[2]) - 1, day = Number(m[3]);
    const d2 = new Date(year, month, day);
    if (!isNaN(d2) && d2.getFullYear() === year && d2.getMonth() === month && d2.getDate() === day) return d2;
  }
  return null;
}

function formatDateNice(dateObj) {
  const days = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
  const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

  const day = dateObj.getDate();
  const suffix =
    (day % 10 === 1 && day !== 11) ? "st" :
    (day % 10 === 2 && day !== 12) ? "nd" :
    (day % 10 === 3 && day !== 13) ? "rd" : "th";

  return `${days[dateObj.getDay()]}-${months[dateObj.getMonth()]}-${day}${suffix}-${String(dateObj.getFullYear()).slice(-2)}`;
}

function keyToSortableDate(key) {
  // We store a hidden sortable date mapping by embedding ISO in the key? No.
  // Instead, attempt to reconstruct from key by parsing out pieces is fragile.
  // So we store metadata in data.__meta for stable sort.
  if (!data.__meta || !data.__meta[key]) return null;
  return data.__meta[key]; // ISO string
}

function ensureMeta() {
  if (!data.__meta || typeof data.__meta !== "object") data.__meta = {};
}

function addDate() {
  const inputEl = document.getElementById("dateInput");
  const raw = inputEl.value.trim();
  if (!raw) return;

  const d = parseUserDate(raw);
  if (!d) {
    alert("Invalid date. Try: 2026-01-01 or Jan 1 2026");
    return;
  }

  const formatted = formatDateNice(d);
  ensureMeta();

  // Prevent duplicates
  if (!(formatted in data)) {
    data[formatted] = 0;
    data.__meta[formatted] = new Date(d.getFullYear(), d.getMonth(), d.getDate()).toISOString();
    save();
    render();
  } else {
    // If exists, just scroll to it (best effort)
    render();
    const row = document.querySelector(`[data-row="${cssEscape(formatted)}"]`);
    if (row) row.scrollIntoView({ behavior: "smooth", block: "center" });
  }

  inputEl.value = "";
  inputEl.focus();
}

function increment(key) {
  data[key] = (data[key] || 0) + 1;
  save();
  render();
}

function decrement(key) {
  data[key] = Math.max(0, (data[key] || 0) - 1);
  save();
  render();
}

function removeDate(key) {
  if (!confirm(`Delete ${key}?`)) return;
  delete data[key];
  if (data.__meta) delete data.__meta[key];
  save();
  render();
}

function resetAll() {
  if (!confirm("This will erase ALL data. Continue?")) return;
  data = {};
  save();
  render();
}

function getEntriesSortedMostRecent() {
  ensureMeta();

  const entries = Object.entries(data)
    .filter(([k]) => k !== "__meta")
    .map(([k, v]) => {
      const iso = data.__meta[k] || null;
      // fallback: if meta missing, treat as very old
      const t = iso ? Date.parse(iso) : 0;
      return { key: k, count: Number(v) || 0, t };
    })
    .sort((a, b) => b.t - a.t);

  return entries;
}

function render() {
  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = "";

  const entries = getEntriesSortedMostRecent();
  let total = 0;

  if (entries.length === 0) {
    tbody.innerHTML = `<tr><td colspan="3" class="empty">No data yet</td></tr>`;
  } else {
    for (const e of entries) {
      total += e.count;

      const tr = document.createElement("tr");
      tr.setAttribute("data-row", e.key);

      tr.innerHTML = `
        <td>${escapeHtml(e.key)}</td>
        <td><span style="color: var(--muted);">Count:</span> <span class="count">${e.count}</span></td>
        <td>
          <div class="actions">
            <button class="actionBtn plus" type="button" aria-label="Increment" onclick="increment('${jsEscape(e.key)}')">+</button>
            <button class="actionBtn minus" type="button" aria-label="Decrement" onclick="decrement('${jsEscape(e.key)}')">−</button>
            <button class="actionBtn del" type="button" aria-label="Delete" onclick="removeDate('${jsEscape(e.key)}')">✕</button>
          </div>
        </td>
      `;
      tbody.appendChild(tr);
    }
  }

  document.getElementById("grandTotal").textContent = total;
  document.getElementById("datesTracked").textContent = entries.length;
}

function exportBackup() {
  // Backup excludes any transient stuff; includes meta for proper sorting
  const payload = {
    version: 2,
    exportedAt: new Date().toISOString(),
    data
  };

  const blob = new Blob([JSON.stringify(payload, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  const stamp = new Date().toISOString().slice(0,10);
  a.href = url;
  a.download = `job-counter-backup-${stamp}.json`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

async function importBackupFromFile(file) {
  try {
    const text = await file.text();
    const parsed = JSON.parse(text);

    // Accept either raw data object (legacy) or v2 payload
    let imported = parsed;
    if (parsed && typeof parsed === "object" && parsed.data && typeof parsed.data === "object") {
      imported = parsed.data;
    }

    if (!imported || typeof imported !== "object" || Array.isArray(imported)) {
      alert("Invalid backup file.");
      return;
    }

    // Validate counts
    const cleaned = {};
    cleaned.__meta = (imported.__meta && typeof imported.__meta === "object") ? imported.__meta : {};

    for (const [k, v] of Object.entries(imported)) {
      if (k === "__meta") continue;
      const n = Number(v);
      if (Number.isFinite(n) && n >= 0) cleaned[k] = Math.floor(n);
    }

    // If meta missing, generate best-effort meta (not perfect but keeps app functional)
    if (!cleaned.__meta) cleaned.__meta = {};
    for (const k of Object.keys(cleaned)) {
      if (k === "__meta") continue;
      if (!cleaned.__meta[k]) cleaned.__meta[k] = new Date(0).toISOString();
    }

    data = cleaned;
    save();
    render();
    alert("Import complete.");
  } catch (e) {
    alert("Could not import file. Make sure it's valid JSON.");
  }
}

/* Helpers for safe string embedding */
function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
function jsEscape(str){
  // Escape for single-quoted JS string in onclick
  return String(str).replaceAll("\\","\\\\").replaceAll("'","\\'");
}
function cssEscape(str){
  // Minimal escape for querySelector attr match
  return String(str).replaceAll('"','\\"');
}

/* Wiring */
document.getElementById("addBtn").addEventListener("click", addDate);
document.getElementById("resetBtn").addEventListener("click", resetAll);
document.getElementById("exportBtn").addEventListener("click", exportBackup);

document.getElementById("importBtn").addEventListener("click", () => {
  document.getElementById("importFile").click();
});
document.getElementById("importFile").addEventListener("change", (e) => {
  const file = e.target.files && e.target.files[0];
  if (!file) return;
  if (!confirm("Importing will replace your current data. Continue?")) {
    e.target.value = "";
    return;
  }
  importBackupFromFile(file);
  e.target.value = "";
});

// UX: Enter key adds date
document.getElementById("dateInput").addEventListener("keydown", (e) => {
  if (e.key === "Enter") addDate();
});

render();
</script>
</body>
</html>
